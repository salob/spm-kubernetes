(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{eyoR:function(e,t,a){"use strict";a.r(t),a.d(t,"_frontmatter",(function(){return b})),a.d(t,"default",(function(){return h}));var n=a("wx14"),l=a("zLVn"),i=(a("q1tI"),a("7ljp")),r=a("013z"),b=(a("qKvR"),{}),c=function(e){return function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),Object(i.b)("div",t)}},o=c("InlineNotification"),s=c("Tabs"),u=c("Tab"),m=c("Row"),p=c("Column"),d={_frontmatter:b},O=r.a;function h(e){var t=e.components,a=Object(l.a)(e,["components"]);return Object(i.b)(O,Object(n.a)({},d,a,{components:t,mdxType:"MDXLayout"}),Object(i.b)(o,{mdxType:"InlineNotification"},"Universal Base Image (UBI) consists of enterprise-ready and OCI-compliant Linux containers that offer greater security with stricter defaults than general images.",Object(i.b)("p",null,"For more information, see Red Hat’s ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://www.redhat.com/en/blog/introducing-red-hat-universal-base-image"}),"Universal Base Image")," and ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://developers.redhat.com/blog/2019/07/29/red-hat-universal-base-image-how-it-works-in-3-minutes-or-less/"}),"Red Hat Universal base image how it works"))),Object(i.b)("p",null,"Some of the base images require ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://access.redhat.com/terms-based-registry"}),"authentication")," with the RedHat Container Registry.\nYou must be logged in to the following registries:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"registry.redhat.io"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"For accessing ",Object(i.b)("inlineCode",{parentName:"li"},"registry.redhat.io/rhel8/httpd-24")),Object(i.b)("li",{parentName:"ul"},"Login using ",Object(i.b)("inlineCode",{parentName:"li"},"docker login registry.redhat.io")))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"registry.connect.redhat.com"),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"For accessing ",Object(i.b)("inlineCode",{parentName:"li"},"registry.connect.redhat.com/ibm/ibmjava8-sdk-ubi8-minimal")),Object(i.b)("li",{parentName:"ul"},"Login using ",Object(i.b)("inlineCode",{parentName:"li"},"docker login registry.connect.redhat.com"))))),Object(i.b)(o,{mdxType:"InlineNotification"},Object(i.b)("p",null,"If you do not have an active RedHat subscription, or prefer to build these images from source, see the ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"../base_images"}),"building Base images")," page."),Object(i.b)("p",null,"Should you opt to build your own base images, the ",Object(i.b)("inlineCode",{parentName:"p"},"BASE_REGISTRY")," argument in the below commands may be omitted, if the base images are built in the same environment.\nIf the images are stored in a private registry, set ",Object(i.b)("inlineCode",{parentName:"p"},"BASE_REGISTRY")," to the registry’s hostname.")),Object(i.b)("p",null,"Now that all the elements are in place, build the images as follows:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"We will use a ",Object(i.b)("inlineCode",{parentName:"p"},"$DOCKER_REGISTRY")," for the commands below. Please select based on the container environment you are deploying."),Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"CRC will be ",Object(i.b)("inlineCode",{parentName:"li"},"default-route-openshift-image-registry.apps-crc.testing")),Object(i.b)("li",{parentName:"ul"},"Minikube will be ",Object(i.b)("inlineCode",{parentName:"li"},"minikube.local:5000")),Object(i.b)("li",{parentName:"ul"},"IKS will be ",Object(i.b)("inlineCode",{parentName:"li"},"us.icr.io")))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"To build the XML server image, run the following commands:"))),Object(i.b)(s,{mdxType:"Tabs"},Object(i.b)(u,{label:"Using RedHat Registry",mdxType:"Tab"},Object(i.b)(m,{mdxType:"Row"},Object(i.b)(p,{mdxType:"Column"},Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell"}),'cd $SPM_HOME/dockerfiles/Liberty/\ndocker build \\\n     --tag $DOCKER_REGISTRY/xmlserver:latest \\\n     --build-arg "BASE_REGISTRY=registry.connect.redhat.com/" \\\n     --file XMLServer.Dockerfile .\n'))))),Object(i.b)(u,{label:"Unauthenticated / Local image",mdxType:"Tab"},Object(i.b)(m,{mdxType:"Row"},Object(i.b)(p,{mdxType:"Column"},Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell"}),"cd $SPM_HOME/dockerfiles/Liberty/\ndocker build \\\n     --tag $DOCKER_REGISTRY/xmlserver:latest \\\n     --file XMLServer.Dockerfile .\n")))))),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"To build the utilities image, run the following commands:",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"This image is used at various stages of the deployment to check the state of the deployment.")))),Object(i.b)(s,{mdxType:"Tabs"},Object(i.b)(u,{label:"Using RedHat Registry",mdxType:"Tab"},Object(i.b)(m,{mdxType:"Row"},Object(i.b)(p,{mdxType:"Column"},Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell"}),'cd $SPM_HOME/dockerfiles/Liberty/\ndocker build \\\n     --tag $DOCKER_REGISTRY/utilities:latest \\\n     --build-arg "BASE_REGISTRY=registry.connect.redhat.com/" \\\n     --file Utilities.Dockerfile .\n'))))),Object(i.b)(u,{label:"Unauthenticated / Local image",mdxType:"Tab"},Object(i.b)(m,{mdxType:"Row"},Object(i.b)(p,{mdxType:"Column"},Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell"}),"cd $SPM_HOME/dockerfiles/Liberty/\ndocker build \\\n     --tag $DOCKER_REGISTRY/utilities:latest \\\n     --file Utilities.Dockerfile .\n")))))),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"To build the batch image, run the following commands:",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"A ",Object(i.b)("inlineCode",{parentName:"li"},".dockerignore")," file is used to omit the EAR files from the build context for batch")))),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell"}),"cd $SPM_HOME/dockerfiles/Liberty/\necho -e 'content/release-stage/ear' > .dockerignore\ndocker build \\\n     --tag $DOCKER_REGISTRY/batch:latest \\\n     --file Batch.Dockerfile .\nrm -f .dockerignore\n")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"To build the Server Code image, run the following commands:")),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell"}),'cd $SPM_HOME/dockerfiles/Liberty/\ndocker build \\\n     --tag $DOCKER_REGISTRY/servercode:latest \\\n     --file ServerEAR.Dockerfile \\\n     --build-arg "MQ_RA_LICENSE=--acceptLicense" .\n')),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"To build the application image, run the following commands for each of the applications (EAR files) needed:",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Take note of the ",Object(i.b)("inlineCode",{parentName:"li"},"SERVERCODE_IMAGE")," build argument which references the server code image above - this gives the images a common base")))),Object(i.b)(s,{mdxType:"Tabs"},Object(i.b)(u,{label:"Curam EAR",mdxType:"Tab"},Object(i.b)(m,{mdxType:"Row"},Object(i.b)(p,{mdxType:"Column"},Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell"}),'cd $SPM_HOME/dockerfiles/Liberty/\ndocker build \\\n     --tag $DOCKER_REGISTRY/curam:latest \\\n     --file ClientEAR.Dockerfile \\\n     --build-arg "SERVERCODE_IMAGE=$DOCKER_REGISTRY/servercode:latest" \\\n     --build-arg "EAR_NAME=Curam" .\n'))))),Object(i.b)(u,{label:"Other EARs",mdxType:"Tab"},Object(i.b)(m,{mdxType:"Row"},Object(i.b)(p,{mdxType:"Column"},Object(i.b)("p",null,"For additional SPM applications (e.g. Rest, CitizenPortal), make the following changes to the command:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"the value of the ",Object(i.b)("inlineCode",{parentName:"li"},"--tag")," argument must be the application name in ",Object(i.b)("em",{parentName:"li"},"lowercase")),Object(i.b)("li",{parentName:"ul"},"the value of the ",Object(i.b)("inlineCode",{parentName:"li"},"--build-arg EAR_NAME")," argument must be the name of the EAR file ",Object(i.b)("em",{parentName:"li"},"without")," the file extension (that is, for ",Object(i.b)("inlineCode",{parentName:"li"},"Rest.ear"),", use the value ",Object(i.b)("inlineCode",{parentName:"li"},"Rest"),")")),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell"}),'docker build \\\n     --tag $DOCKER_REGISTRY/rest:latest \\\n     --file ClientEAR.Dockerfile \\\n     --build-arg "SERVERCODE_IMAGE=$DOCKER_REGISTRY/servercode:latest" \\\n     --build-arg "EAR_NAME=Rest" .\n')))))),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"To build the static content image, run the following commands:")),Object(i.b)(s,{mdxType:"Tabs"},Object(i.b)(u,{label:"Using RedHat Registry",mdxType:"Tab"},Object(i.b)(m,{mdxType:"Row"},Object(i.b)(p,{mdxType:"Column"},Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell"}),'cd $SPM_HOME/dockerfiles/HTTPServer/\ndocker build \\\n     --tag $DOCKER_REGISTRY/httpd:latest \\\n     --file StaticContent.Dockerfile \\\n     --build-arg "BASE_REGISTRY=registry.redhat.io/" \\\n     --build-arg "CONTENT_DIR=/CuramStatic" .\n'))))),Object(i.b)(u,{label:"Unauthenticated / Local image",mdxType:"Tab"},Object(i.b)(m,{mdxType:"Row"},Object(i.b)(p,{mdxType:"Column"},Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell"}),'cd $SPM_HOME/dockerfiles/HTTPServer/\ndocker build \\\n     --tag $DOCKER_REGISTRY/httpd:latest \\\n     --file StaticContent.Dockerfile \\\n     --build-arg "CONTENT_DIR=/CuramStatic" .\n')))))),Object(i.b)(o,{mdxType:"InlineNotification"},Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Note:")," The ",Object(i.b)("inlineCode",{parentName:"p"},"CONTENT_DIR")," build argument must correspond to the value set in ",Object(i.b)("inlineCode",{parentName:"p"},"curam-config.xml")," when the webclient was build.")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"To build an SPM Docker image for your ",Object(i.b)("em",{parentName:"li"},"built")," Universal Access application:",Object(i.b)("ul",{parentName:"li"},Object(i.b)("li",{parentName:"ul"},"Copy the ",Object(i.b)("inlineCode",{parentName:"li"},"build")," directory from the React application to ",Object(i.b)("inlineCode",{parentName:"li"},"$SPM_HOME/dockerfiles/HTTPServer")),Object(i.b)("li",{parentName:"ul"},"Run the following commands:")))),Object(i.b)(o,{mdxType:"InlineNotification"},Object(i.b)("p",null,"This is applicable only if you are licensed for ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://www.ibm.com/support/knowledgecenter/SS8S5A_7.0.10/com.ibm.curam.universalaccess.doc/CitizenEngagement/ctr_CitizenEngagementApplication.html"}),"Universal Access")),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Note:")," The ",Object(i.b)("inlineCode",{parentName:"p"},"CONTENT_DIR")," build argument must correspond to the value of the ",Object(i.b)("inlineCode",{parentName:"p"},"PUBLIC_URL")," variable set when creating the production build of the React app (",Object(i.b)("inlineCode",{parentName:"p"},"npm run build"),").")),Object(i.b)(s,{mdxType:"Tabs"},Object(i.b)(u,{label:"Using RedHat Registry",mdxType:"Tab"},Object(i.b)(m,{mdxType:"Row"},Object(i.b)(p,{mdxType:"Column"},Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell"}),'cd $SPM_HOME/dockerfiles/HTTPServer/\ndocker build \\\n     --tag $DOCKER_REGISTRY/uawebapp:latest \\\n     --file UAWebApp.Dockerfile \\\n     --build-arg "BASE_REGISTRY=registry.redhat.io/" \\\n     --build-arg "CONTENT_DIR=/universal" .\n'))))),Object(i.b)(u,{label:"Unauthenticated / Local image",mdxType:"Tab"},Object(i.b)(m,{mdxType:"Row"},Object(i.b)(p,{mdxType:"Column"},Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell"}),'cd $SPM_HOME/dockerfiles/HTTPServer/\ndocker build \\\n     --tag $DOCKER_REGISTRY/uawebapp:latest \\\n     --file UAWebApp.Dockerfile \\\n     --build-arg "CONTENT_DIR=/universal" .\n')))))),Object(i.b)("h2",null,"Pushing the images to the registry"),Object(i.b)("p",null,"When you set up Minikube by following the steps in ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"/spm-kubernetes/prereq/kubernetes/minikube"}),"Minikube"),", a registry was also created to store the Docker images.\nTo push the new images that you created to the registry, run the following shell script:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell"}),"docker push $DOCKER_REGISTRY/xmlserver:latest\ndocker push $DOCKER_REGISTRY/utilities:latest\ndocker push $DOCKER_REGISTRY/batch:latest\ndocker push $DOCKER_REGISTRY/servercode:latest\ndocker push $DOCKER_REGISTRY/curam:latest\ndocker push $DOCKER_REGISTRY/httpd:latest\n")),Object(i.b)(o,{mdxType:"InlineNotification"},Object(i.b)("p",null,"If any additional images were built (for other SPM applications or for the React application), do not forget to push the images too. For example:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell"}),"docker push $DOCKER_REGISTRY/rest:latest\ndocker push $DOCKER_REGISTRY/uawebapp:latest\n"))),Object(i.b)("h2",null,"Pushing the images to the IBM Cloud Container Registry"),Object(i.b)("p",null,"IBM Cloud Container Registry is the service to distribute the containers across Kubernetes clusters. In order to configure it, some preparation steps are\nrequired to obtain the credentials and a namespace, globally unique between all the tenants of IBM Cloud.\nRefer to ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://cloud.ibm.com/docs/Registry?topic=Registry-getting-started"}),"Getting started with IBM Cloud Container Registry")," for more information on configuring the registry and obtaining the required credentials."),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell"}),"ibmcloud login -c <ICR_ENDPOINT> --apikey <ICR_API_KEY> -r <ICR_DC_REGION>\nibmcloud cr login\n\ndocker push us.icr.io/<ICR_NAMESPACE>/xmlserver:latest\ndocker push us.icr.io/<ICR_NAMESPACE>/utilities:latest\ndocker push us.icr.io/<ICR_NAMESPACE>/batch:latest\ndocker push us.icr.io/<ICR_NAMESPACE>/curam:latest\ndocker push us.icr.io/<ICR_NAMESPACE>/httpd:latest\n")),Object(i.b)("h2",null,"View the artifacts in the repository"),Object(i.b)("p",null,"Confirm that the pushes to the Docker registry succeeded. Run the following command:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-shell"}),"curl http://$DOCKER_REGISTRY/v2/_catalog\n")),Object(i.b)("p",null,"The command returns the following result:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{className:"language-json"}),'{"repositories":["batch","curam","xmlserver","httpd","utilities"]}\n')),Object(i.b)(o,{mdxType:"InlineNotification"},Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Note:")," When you shut down Minikube, you might need to repush the Docker images to the registry.")),Object(i.b)("p",null,"For more information about the Docker Registry HTTP API, see ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://docs.docker.com/registry/spec/api/"}),"Docker Registry HTTP API V2"),"."))}h.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-build-images-build-images-mdx-2d6f118701ef3da3faaa.js.map