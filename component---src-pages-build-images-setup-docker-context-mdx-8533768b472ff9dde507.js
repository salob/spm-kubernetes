(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{YGih:function(e,t,n){"use strict";n.r(t),n.d(t,"_frontmatter",(function(){return b})),n.d(t,"default",(function(){return d}));var a,i=n("wx14"),r=n("zLVn"),o=(n("q1tI"),n("7ljp")),l=n("013z"),b=(n("qKvR"),{}),p=(a="InlineNotification",function(e){return console.warn("Component "+a+" was not imported, exported, or provided by MDXProvider as global scope"),Object(o.b)("div",e)}),c={_frontmatter:b},s=l.a;function d(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(o.b)(s,Object(i.a)({},c,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"To build the required Docker images, the context for building them must be established as described in the ",Object(o.b)("a",Object(i.a)({parentName:"p"},{href:"https://docs.docker.com/engine/reference/commandline/build/"}),"Docker build")," command description."),Object(o.b)("p",null,"The following components provide this context:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"The artifacts that you downloaded by following the steps that are described in ",Object(o.b)("a",Object(i.a)({parentName:"li"},{href:"/spm-kubernetes/prereq/git"}),"GitHub repo"),"."),Object(o.b)("li",{parentName:"ul"},"The ",Object(o.b)("inlineCode",{parentName:"li"},"release.zip")," and ",Object(o.b)("inlineCode",{parentName:"li"},"StaticContent.zip")," files that you built in ",Object(o.b)("a",Object(i.a)({parentName:"li"},{href:"/spm-kubernetes/deploy-spm/spm-build"}),"Building the SPM application"),".")),Object(o.b)("h2",null,"Building IBM® Social Program Management (SPM) resources"),Object(o.b)("p",null,"Some of the Docker images that you build rely on the ",Object(o.b)("inlineCode",{parentName:"p"},"release.zip")," and ",Object(o.b)("inlineCode",{parentName:"p"},"StaticContent.zip")," files that you built in ",Object(o.b)("a",Object(i.a)({parentName:"p"},{href:"/spm-kubernetes/deploy-spm/spm-build"}),"Building the SPM application"),"."),Object(o.b)("p",null,"If you built ",Object(o.b)("inlineCode",{parentName:"p"},"release.zip")," and ",Object(o.b)("inlineCode",{parentName:"p"},"StaticContent.zip")," on a different computer to the one where container environment will be deployed, you must transfer the files to the computer you’re currently working on.\nFor simplicity, it is assumed that these files are copied to ",Object(o.b)("inlineCode",{parentName:"p"},"/tmp/"),"."),Object(o.b)("h2",null,"Preparing the SPM environment"),Object(o.b)("p",null,"Prepare the SPM Docker environment by using the ",Object(o.b)("inlineCode",{parentName:"p"},"release.zip")," file."),Object(o.b)("p",null,"For the following steps, use the ",Object(o.b)("inlineCode",{parentName:"p"},"$SPM_HOME")," folder that you created in ",Object(o.b)("a",Object(i.a)({parentName:"p"},{href:"/spm-kubernetes/prereq/git"}),"GitHub repo"),"."),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"To create a ",Object(o.b)("inlineCode",{parentName:"p"},"release-stage")," folder to contain the contents of ",Object(o.b)("inlineCode",{parentName:"p"},"release.zip"),", run the following command:"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(i.a)({parentName:"pre"},{className:"language-shell"}),"mkdir $SPM_HOME/dockerfiles/Liberty/content/release-stage\n"))),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"To extract ",Object(o.b)("inlineCode",{parentName:"p"},"release.zip")," into the ",Object(o.b)("inlineCode",{parentName:"p"},"release-stage")," folder, run the following commands:"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(i.a)({parentName:"pre"},{className:"language-shell"}),"unzip -qd $SPM_HOME/dockerfiles/Liberty/content/release-stage /tmp/release.zip\nchmod +x $SPM_HOME/dockerfiles/Liberty/content/release-stage/*.sh\n")),Object(o.b)("p",{parentName:"li"},"Where ",Object(o.b)("inlineCode",{parentName:"p"},"/tmp/release.zip")," is the absolute path where the ",Object(o.b)("inlineCode",{parentName:"p"},"release.zip")," is saved."))),Object(o.b)("h2",null,"Modifying SPM properties"),Object(o.b)("p",null,Object(o.b)("inlineCode",{parentName:"p"},"Bootstrap.properties")," and ",Object(o.b)("inlineCode",{parentName:"p"},"AppServer.properties")," are required to configure WebSphere® Liberty.\nHowever the relevant properties in ",Object(o.b)("inlineCode",{parentName:"p"},"Bootstrap.properties")," that you modify in the on-premise implementation of SPM are no longer relevant because Kubernetes configmaps provide the necessary values for the database configuration."),Object(o.b)("p",null,"The only properties that you must modify in ",Object(o.b)("inlineCode",{parentName:"p"},"AppServer.properties")," are ",Object(o.b)("inlineCode",{parentName:"p"},"security.username")," and ",Object(o.b)("inlineCode",{parentName:"p"},"security.password"),".\nThese properties contain the WebSphere Liberty administrator credentials. If the password is changed, the value must be the encrypted  by running the following commands:"),Object(o.b)("pre",null,Object(o.b)("code",Object(i.a)({parentName:"pre"},{className:"language-shell"}),"cd $SERVER_DIR\n./build.sh encrypt -Dpassword=<The password to be encrypted>\n")),Object(o.b)("p",null,"Copy the property files by using the following command:"),Object(o.b)("pre",null,Object(o.b)("code",Object(i.a)({parentName:"pre"},{className:"language-shell"}),"cd $SPM_HOME/dockerfiles/Liberty/content\ncp -vf *.properties release-stage/project/properties/\n")),Object(o.b)("h2",null,"WebSphere Liberty server configuration"),Object(o.b)("p",null,"All configuration of WebSphere Liberty will be handled by the Helm Charts. See the ",Object(o.b)("a",Object(i.a)({parentName:"p"},{href:"/spm-kubernetes/deployment/hc_preparation"}),"Preparing Helm Charts")," topic for more information."),Object(o.b)("h2",null,"Copying static content artifacts"),Object(o.b)("p",null,"Copy the static content ",Object(o.b)("inlineCode",{parentName:"p"},".zip")," file for Docker image creation. Run the following command:"),Object(o.b)("pre",null,Object(o.b)("code",Object(i.a)({parentName:"pre"},{className:"language-shell"}),"cp -vf /tmp/StaticContent.zip $SPM_HOME/dockerfiles/HTTPServer/\n")),Object(o.b)("h2",null,"Installing external artifacts"),Object(o.b)("p",null,"In addition to ",Object(o.b)("inlineCode",{parentName:"p"},"release.zip")," and ",Object(o.b)("inlineCode",{parentName:"p"},"StaticContent.zip"),", download and install the following artifacts."),Object(o.b)("h3",null,"Add the Ant zip file to the Docker environment"),Object(o.b)("p",null,"Copy ",Object(o.b)("inlineCode",{parentName:"p"},"apache-ant-1.10.6-bin.zip")," to ",Object(o.b)("inlineCode",{parentName:"p"},"$SPM_HOME/dockerfiles/Liberty/content"),". If Ant is not already available on the computer, run the following commands:"),Object(o.b)("pre",null,Object(o.b)("code",Object(i.a)({parentName:"pre"},{className:"language-shell"}),"cd $SPM_HOME/dockerfiles/Liberty/content\nwget https://archive.apache.org/dist/ant/binaries/apache-ant-1.10.6-bin.zip\n")),Object(o.b)("h3",null,"CryptoConfig.jar"),Object(o.b)("p",null,Object(o.b)("inlineCode",{parentName:"p"},"CryptoConfig.jar")," is required for SPM cryptography to function correctly. This jar is automatically created in the following locations when you run the\n",Object(o.b)("inlineCode",{parentName:"p"},"build.sh configtest")," target:"),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"$SERVER_DIR/build/CryptoConfig.jar")),Object(o.b)("li",{parentName:"ul"},Object(o.b)("inlineCode",{parentName:"li"},"$JAVA_HOME/jre/lib/ext/CryptoConfig.jar"))),Object(o.b)("p",null,"However, the ",Object(o.b)("inlineCode",{parentName:"p"},"release.zip")," does not include this jar file, so the jar file must be copied separately from the environment where the ",Object(o.b)("inlineCode",{parentName:"p"},"release.zip")," was built."),Object(o.b)("p",null,"Place the ",Object(o.b)("inlineCode",{parentName:"p"},"CryptoConfig.jar")," file in ",Object(o.b)("inlineCode",{parentName:"p"},"$SPM_HOME/dockerfiles/Liberty/content/release-stage/build"),"."),Object(o.b)(p,{mdxType:"InlineNotification"},Object(o.b)("p",null,"Cryptography keystores for SPM vary based on the JVM vendor, so the vendor in the build environment must correspond to that used in the Docker images.\nThe ",Object(o.b)("inlineCode",{parentName:"p"},"websphere-liberty")," images from ",Object(o.b)("a",Object(i.a)({parentName:"p"},{href:"https://hub.docker.com/_/websphere-liberty"}),"Docker Hub")," use IBM Java SDK 8.")),Object(o.b)("p",null,"For convenience, you can use the following command to create a ",Object(o.b)("inlineCode",{parentName:"p"},"CryptoConfig.jar")," file in a Docker container:"),Object(o.b)("pre",null,Object(o.b)("code",Object(i.a)({parentName:"pre"},{className:"language-shell"}),"docker run --rm \\\n    -v $ANT_HOME:/tmp/ant \\\n    -v $SPM_HOME/dockerfiles/Liberty/content/release-stage:/work/dir \\\n    -v $SPM_HOME/dockerfiles/Liberty/content/release-stage/SetEnvironment.sh:/work/SetEnvironment.sh \\\n    -w /work/dir \\\n    -u root \\\n    -e ANT_HOME=/tmp/ant \\\n    -e WLP_HOME=/opt/ibm/wlp \\\n    websphere-liberty:20.0.0.9-full-java8-ibmjava \\\n    bash -c 'export PATH=$ANT_HOME/bin:$PATH:.; build.sh internal.update.crypto.jar'\n")),Object(o.b)(p,{mdxType:"InlineNotification"},Object(o.b)("p",null,"Note the use of ",Object(o.b)("inlineCode",{parentName:"p"},"$ANT_HOME")," above. The value must map to a working copy of Ant on your workstation, which can be extracted from ",Object(o.b)("inlineCode",{parentName:"p"},"$SPM_HOME/dockerfiles/Liberty/content/apache-ant-1.10.6-bin.zip"),":")),Object(o.b)("pre",null,Object(o.b)("code",Object(i.a)({parentName:"pre"},{className:"language-shell"}),"# Ignore this step if ANT_HOME is already set.\nunzip -qd /tmp/ $SPM_HOME/dockerfiles/Liberty/content/apache-ant-1.10.6-bin.zip\nexport ANT_HOME=/tmp/apache-ant-1.10.6\n")),Object(o.b)("h3",null,"Installing javax.mail.jar and activation.jar files"),Object(o.b)("p",null,"Java Mail is an external dependency for SPM and is represented by the JAR files ",Object(o.b)("inlineCode",{parentName:"p"},"activation.jar")," and ",Object(o.b)("inlineCode",{parentName:"p"},"javax.mail.jar"),".\nPlace these files in the folder ",Object(o.b)("inlineCode",{parentName:"p"},"$SPM_HOME/dockerfiles/Liberty/content/dependencies")," (filenames must be exact, that is, have no version numbers)."),Object(o.b)("p",null,"If you do not have the jar files available, you can use the ",Object(o.b)("inlineCode",{parentName:"p"},"getJavaMail.xml")," Ant file that is located in the ",Object(o.b)("inlineCode",{parentName:"p"},"$SPM_HOME/dockerfiles/Liberty/content")," folder to download the files:"),Object(o.b)("pre",null,Object(o.b)("code",Object(i.a)({parentName:"pre"},{className:"language-shell"}),"cd $SPM_HOME/dockerfiles/Liberty/content\n$ANT_HOME/bin/ant -f getJavaMail.xml\n")),Object(o.b)("p",null,"Confirm the availability of the JAR files by running the following command:"),Object(o.b)("p",null,Object(o.b)("inlineCode",{parentName:"p"},"ls $SPM_HOME/dockerfiles/Liberty/content/dependencies")),Object(o.b)("h3",null,"Downloading IBM MQ Resource Adapter"),Object(o.b)(p,{mdxType:"InlineNotification"},Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"Note:")," As of Release 20.7.0, the IBM MQ Resource Adapter version used to verify this runbook is 9.1.5.0.")),Object(o.b)("p",null,"IBM MQ is required for WebSphere Liberty JMS support, therefore you must install the MQ Resource Adapter."),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Download the IBM MQ resource adapter from Fix Central."),Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Click this link: ",Object(o.b)("a",Object(i.a)({parentName:"p"},{href:"https://ibm.biz/mq91cdRA"}),"IBM MQ Resource Adapter"))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Find the resource adapter for your version of IBM MQ in the displayed list of available fixes. For example:"),Object(o.b)("pre",{parentName:"li"},Object(o.b)("code",Object(i.a)({parentName:"pre"},{}),"release level: 9.1.5.0-IBM-MQ-Java-InstallRA\nContinuous Delivery Release: 9.1.5 IBM MQ Resource Adapter for use with Application Servers\n"))),Object(o.b)("li",{parentName:"ul"},Object(o.b)("p",{parentName:"li"},"Then click the resource adapter file name and follow the download process.")))),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Copy the downloaded file ( ",Object(o.b)("inlineCode",{parentName:"p"},"V.R.M.F-IBM-MQ-Java-InstallRA.jar")," ) to ",Object(o.b)("inlineCode",{parentName:"p"},"$SPM_HOME/dockerfiles/Liberty/content/"),"."))))}d.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-build-images-setup-docker-context-mdx-8533768b472ff9dde507.js.map